<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Highstock Example</title>

		<style type="text/css">
.highcharts-figure {
    min-width: 310px;
    max-width: 800px;
    margin: 0 auto;
}

.highcharts-figure p {
    margin: 10px;
}

		</style>
	</head>
	<body>
<script src="../../code/highstock.js"></script>
<script src="../../code/highcharts-more.js"></script>
<script src="../../code/modules/exporting.js"></script>
<script src="../../code/modules/export-data.js"></script>

<figure class="highcharts-figure">
    <div id="container"></div>
    <p class="highcharts-description">
        Renko series in technical analysis is designed to filter out minor
        fluctuations in price data by focusing solely on significant price
        movements. Unlike typical charting methods that consider time and
        volume, Renko charts are only influenced by price changes. Each brick in
        a Renko chart represents a movement in price up or down by a predefined
        amount, known as the brick size or box size. Bricks are placed in the
        next column only when the movement in the price is opposite to the
        direction of the previous brick, effectively highlighting trends and
        reversals.

        <p>This series requires a <code>[Close Price, Date]</code> format data
            and all of the calculations are done under the hood.</p>

        <p>The brick size/box size is set to <code>5</code>, but it can be
            easily changed to any other number by changing the second parameter
            in <code>linearDataToRenko</code> function call.
        </p>
    </p>
</figure>


		<script type="text/javascript">
(async () => {
    const linearData = await fetch(
        'https://www.highcharts.com/samples/data/aapl-c.json'
    ).then(response => response.json());

    // Generate data in renko format from linear dataset
    function linearDataToRenko(data, change) {
        const renkoData = [],
            length = data.length;

        let prevPrice = data[0][1],
            prevTrend = 0; // 0 - no trend, 1 - uptrend, 2 - downtrend

        for (let i = 1; i < length; i++) {
            const currentChange = data[i][1] - data[i - 1][1];
            if (currentChange > change) {
                // Uptrend
                if (prevTrend === 2) {
                    prevPrice += change;
                }

                for (let j = 0; j < currentChange / change; j++) {
                    renkoData.push({
                        x: data[i][0] + j,
                        y: prevPrice,
                        low: prevPrice,
                        high: prevPrice + change
                    });
                    prevPrice += change;
                }
                prevTrend = 1;

            } else if (Math.abs(currentChange) > change) {

                if (prevTrend === 1) {
                    prevPrice -= change;
                }
                // Downtrend
                for (let j = 0; j < Math.abs(currentChange) / change; j++) {
                    renkoData.push({
                        x: data[i][0] + j,
                        y: prevPrice,
                        low: prevPrice - change,
                        high: prevPrice,
                        color: '#ff0000'
                    });
                    prevPrice -= change;
                }
                prevTrend = 2;
            }
        }
        return renkoData;
    }

    // Change "5" to check smaller steps.
    const data = linearDataToRenko(linearData, 5);
    // Create the chart
    Highcharts.stockChart('container', {
        rangeSelector: {
            selected: 1
        },
        title: {
            text: 'AAPL Stock Price on Renko chart'
        },
        series: [{
            name: 'AAPL',
            type: 'columnrange',
            fillColor: 'transparent',
            color: '#0000ff',
            turboThreshold: 0,
            groupPadding: 0,
            pointPadding: 0,
            borderWidth: 1,
            data: data,
            dataGrouping: {
                enabled: false
            },
            tooltip: {
                valueDecimals: 2
            }
        }]
    });
})();
		</script>
	</body>
</html>
